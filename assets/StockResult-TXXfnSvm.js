import{a as e,i as t,o as n,s as r,t as i}from"./index-BagyG680.js";import{t as a}from"./Breadcrumbs-DNDuVtLa.js";var o=e(),s=r(n(),1),c=i(),l=e=>{let t=(0,o.c)(11),{onUpdatePrices:n,onRefreshData:r,updatingPrices:i}=e,a=i?`Fetching latest prices from Yahoo Finance`:`Fetch latest Current Price and 52W High/Low`,s=i?`Updating prices`:`Update prices`,l=i?`Updating...`:`Update Prices`,u;t[0]!==n||t[1]!==a||t[2]!==s||t[3]!==l||t[4]!==i?(u=(0,c.jsx)(`button`,{onClick:n,disabled:i,title:a,"aria-label":s,className:`px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-400`,children:l}),t[0]=n,t[1]=a,t[2]=s,t[3]=l,t[4]=i,t[5]=u):u=t[5];let d;t[6]===r?d=t[7]:(d=(0,c.jsx)(`button`,{onClick:r,title:`Re-read Excel, recalculate fields and fetch fresh prices`,"aria-label":`Refresh data from Excel and update prices`,className:`px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600`,children:`Refresh Data`}),t[6]=r,t[7]=d);let f;return t[8]!==u||t[9]!==d?(f=(0,c.jsxs)(`div`,{className:`flex gap-2`,children:[u,d]}),t[8]=u,t[9]=d,t[10]=f):f=t[10],f},u=e(),d=e=>{let t=(0,u.c)(10),{totalRecords:n,lastUpdated:r,lastPriceUpdate:i}=e,a;t[0]===n?a=t[1]:(a=(0,c.jsxs)(`p`,{className:`text-gray-600`,children:[`Total Records: `,n]}),t[0]=n,t[1]=a);let o;t[2]===r?o=t[3]:(o=r&&(0,c.jsxs)(`p`,{className:`text-gray-600 text-sm`,children:[`Data Last Updated: `,new Date(r).toLocaleString()]}),t[2]=r,t[3]=o);let s;t[4]===i?s=t[5]:(s=i&&(0,c.jsxs)(`p`,{className:`text-gray-600 text-sm`,children:[`Prices Last Updated: `,new Date(i).toLocaleString()]}),t[4]=i,t[5]=s);let l;return t[6]!==a||t[7]!==o||t[8]!==s?(l=(0,c.jsxs)(`div`,{className:`mb-4 space-y-1`,children:[a,o,s]}),t[6]=a,t[7]=o,t[8]=s,t[9]=l):l=t[9],l};const f={baseUrl:`/yahooFinance/v8/finance/chart`,exchanges:{nse:`NS`,bse:`BO`}},p={Symbol:`Symbol`,ISIN:`ISIN`,Quantity:`Quantity`,BuyValue:`Buy Value`,SellValue:`Sell Value`,RealizedPL:`Realized P&L`,RealizedPLPct:`Realized P&L Pct.`,PreviousClosingPrice:`Previous Closing Price`,FiftyTwoWeekHigh:`52W High`,FiftyTwoWeekLow:`52W Low`,NearFiftyTwoWeekLow:`Near 52W Low`,CurrentPrice:`Current Price`,RealizedPriceVsValue:`Realized Price vs Value`,UnrealizedPriceToCmp:`Unrealized Price to Cmp`,OpenQuantity:`Open Quantity`,OpenQuantityType:`Open Quantity Type`,OpenValue:`Open Value`,UnrealizedPL:`Unrealized P&L`,UnrealizedPLPct:`Unrealized P&L Pct.`,CustomRealisedStockValue:`Custom Realised Stock Value`,CustomUnrealisedStockValue:`Custom Unrealised Stock Value`,BuyValuePerStock:`Buy Value Per Stock`,SellValuePerStock:`Sell Value Per Stock`},m=[p.RealizedPL,p.RealizedPLPct,p.UnrealizedPL,p.UnrealizedPLPct],h=[{key:p.Symbol,label:`Symbol`},{key:p.FiftyTwoWeekHigh,label:`52W High`,align:`right`},{key:p.FiftyTwoWeekLow,label:`52W Low`,align:`right`},{key:p.NearFiftyTwoWeekLow,label:`Near 52W Low`},{key:p.CurrentPrice,label:`Current Price`,align:`right`},{key:p.RealizedPriceVsValue,label:`Realized Price vs Value`,align:`right`},{key:p.UnrealizedPriceToCmp,label:`Unrealized Price to Cmp`,align:`right`},{key:p.CustomRealisedStockValue,label:`Custom Realised Stock Value`,align:`right`},{key:p.CustomUnrealisedStockValue,label:`Custom Unrealised Stock Value`,align:`right`},{key:p.RealizedPL,label:`Realized P&L`,align:`right`},{key:p.UnrealizedPL,label:`Unrealized P&L`,align:`right`},{key:p.BuyValuePerStock,label:`Buy Value Per Stock`,align:`right`},{key:p.SellValuePerStock,label:`Sell Value Per Stock`,align:`right`},{key:p.Quantity,label:`Quantity`,align:`right`},{key:p.BuyValue,label:`Buy Value`,align:`right`},{key:p.SellValue,label:`Sell Value`,align:`right`},{key:p.RealizedPLPct,label:`Realized P&L %`,align:`right`},{key:p.PreviousClosingPrice,label:`Previous Close`,align:`right`},{key:p.OpenQuantity,label:`Open Quantity`,align:`right`},{key:p.OpenQuantityType,label:`Open Qty Type`},{key:p.OpenValue,label:`Open Value`,align:`right`},{key:p.UnrealizedPLPct,label:`Unrealized P&L %`,align:`right`}];async function g(e){let n=await t(()=>import(`./xlsx-2iBKk0v1.js`),[]),r=n.read(e,{type:`array`}).Sheets.Equity;if(!r)throw Error(`Equity sheet not found in Excel file`);let i=n.utils.sheet_to_json(r,{header:1,raw:!1,defval:null,blankrows:!1}),a=i.findIndex(e=>Array.isArray(e)&&e.length>0&&String(e[0]).trim()===`Symbol`);if(a===-1)throw Error(`Could not find header row with "Symbol" column`);let o=i[a];return i.slice(a+1).filter(e=>e&&e.length>0&&e[0]).map(e=>{let t={};return o.forEach((n,r)=>{t[String(n).trim()]=e[r]??null}),t}).map(e=>({[p.Symbol]:String(e[p.Symbol]??``).trim(),[p.ISIN]:String(e[p.ISIN]??``).trim(),[p.Quantity]:Number(e[p.Quantity]??0)||0,[p.BuyValue]:Number(e[p.BuyValue]??0)||0,[p.SellValue]:Number(e[p.SellValue]??0)||0,[p.RealizedPL]:Number(e[p.RealizedPL]??0)||0,[p.RealizedPLPct]:Number(e[p.RealizedPLPct]??0)||0,[p.PreviousClosingPrice]:Number(e[p.PreviousClosingPrice]??0)||0,[p.OpenQuantity]:Number(e[p.OpenQuantity]??0)||0,[p.OpenQuantityType]:String(e[p.OpenQuantityType]??``).trim(),[p.OpenValue]:Number(e[p.OpenValue]??0)||0,[p.UnrealizedPL]:Number(e[p.UnrealizedPL]??0)||0,[p.UnrealizedPLPct]:Number(e[p.UnrealizedPLPct]??0)||0}))}function _(e){return e.map(e=>{let t=Number(e[p.RealizedPL])||0,n=Number(e[p.Quantity])||1,r=(Number(e[p.BuyValue])||0)/n,i=(Number(e[p.SellValue])||0)/n,a;a=t>0?+(r-t/n).toFixed(2):+i.toFixed(2);let o=Number(e[p.UnrealizedPL])||0,s=Number(e[p.OpenQuantity])||1,c=o/s,l=+((Number(e[p.OpenValue])||0)/s+c).toFixed(2);return{...e,[p.BuyValuePerStock]:+r.toFixed(2),[p.SellValuePerStock]:+i.toFixed(2),[p.CustomRealisedStockValue]:a,[p.CustomUnrealisedStockValue]:l}})}async function v(e,t=f.exchanges.nse){try{let n=e.split(`-`)[0],r=`${f.baseUrl}/${n}.${t}`,i=await fetch(r);if(!i.ok)return console.warn(`Yahoo Finance API error for ${e}: ${i.status} ${i.statusText}`),y();let a=(await i.json()).chart.result[0]?.meta;return{price:a?.regularMarketPrice||null,fiftyTwoWeekHigh:a?.fiftyTwoWeekHigh||null,fiftyTwoWeekLow:a?.fiftyTwoWeekLow||null}}catch(t){return console.warn(`Yahoo Finance API error for`,e,t),y()}}function y(){return{price:null,fiftyTwoWeekHigh:null,fiftyTwoWeekLow:null}}async function b(e){let t=Array.from(new Set(e.filter(Boolean)));if(t.length===0)return{};let n={},r=await x(t,e=>v(e,f.exchanges.nse));r.forEach(({symbol:e,...t})=>{n[e]=t});let i=r.filter(({price:e})=>e===null).map(({symbol:e})=>e);if(console.log(`Symbols with null prices from primary exchange:`,i),i.length>0){let e=await x(i,e=>v(e,f.exchanges.bse));console.log(`Fallback exchange results:`,e),e.forEach(({symbol:e,...t})=>{n[e].price===null&&t.price!==null&&(n[e]=t)})}return n}async function x(e,t){let n=e.map(async e=>{try{return{symbol:e,...await t(e)}}catch{return{symbol:e,...y()}}});return Promise.all(n)}async function S(){try{let e=await fetch(`/src/privateDocument/stockData.json`);if(!e.ok)return console.log(`No stored data file found (stockData.json)`),null;let t=await e.json();return console.log(`Loaded ${t.stocks.length} stocks from stockData.json`),t}catch(e){return console.warn(`Error loading JSON data from file:`,e),null}}async function C(e){let t=await b(e.stocks.map(e=>e.Symbol)),n=e.stocks.map(e=>({...e,[p.CurrentPrice]:t[e.Symbol]?.price??e[p.CurrentPrice]??null,[p.FiftyTwoWeekHigh]:t[e.Symbol]?.fiftyTwoWeekHigh??e[p.FiftyTwoWeekHigh]??null,[p.FiftyTwoWeekLow]:t[e.Symbol]?.fiftyTwoWeekLow??e[p.FiftyTwoWeekLow]??null})),r={...e,metadata:{...e.metadata,lastPriceUpdate:new Date().toISOString()},stocks:n},i=JSON.stringify(r,null,2),a=new Blob([i],{type:`application/json`}),o=URL.createObjectURL(a),s=document.createElement(`a`);return s.href=o,s.download=`stockData.json`,s.click(),URL.revokeObjectURL(o),console.log(`Updated stock data prepared for download`),console.log(`Please save the downloaded stockData.json file to: src/privateDocument/stockData.json`),r}function w(e,t,n,r){return!t||!n?e:[...e].sort((e,i)=>{let a=e[t],o=i[t];if(t===p.CurrentPrice||t===p.FiftyTwoWeekHigh||t===p.FiftyTwoWeekLow){let n=e[p.Symbol],s=i[p.Symbol],c=r[n],l=r[s];t===p.CurrentPrice?(a=c?.price??e[p.CurrentPrice],o=l?.price??i[p.CurrentPrice]):t===p.FiftyTwoWeekHigh?(a=c?.fiftyTwoWeekHigh,o=l?.fiftyTwoWeekHigh):t===p.FiftyTwoWeekLow&&(a=c?.fiftyTwoWeekLow,o=l?.fiftyTwoWeekLow)}if(a==null&&o==null)return 0;if(a==null)return n===`asc`?1:-1;if(o==null)return n===`asc`?-1:1;if(typeof a==`number`&&typeof o==`number`)return n===`asc`?a-o:o-a;let s=String(a).toLowerCase(),c=String(o).toLowerCase();return n===`asc`?s<c?-1:s>c?1:0:s>c?-1:s<c?1:0})}function T(e,t,n){return t===e?n===`asc`?(0,c.jsx)(`span`,{className:`ml-1 text-blue-600`,children:`↑`}):(0,c.jsx)(`span`,{className:`ml-1 text-blue-600`,children:`↓`}):(0,c.jsx)(`span`,{className:`ml-1 text-gray-400`,children:`⇅`})}function E(e,t,n){if(t===e){if(n===`asc`)return{sortColumn:e,sortDirection:`desc`};if(n===`desc`)return{sortColumn:null,sortDirection:null}}return{sortColumn:e,sortDirection:`asc`}}function D(e,t){let n={},r=0,i=0;return e.forEach(e=>{[p.Quantity,p.BuyValue,p.SellValue,p.RealizedPL,p.UnrealizedPL,p.OpenQuantity].forEach(t=>{let r=e[t];typeof r==`number`&&(n[t]=(n[t]||0)+r)});let a=e[p.BuyValue];typeof a==`number`&&(r+=a);let o=e[p.OpenQuantity],s=t[e[p.Symbol]];o&&typeof o==`number`&&s?.price!=null&&(i+=s.price*o);let c=e[p.Quantity];if(c&&typeof c==`number`){let t=e[p.BuyValuePerStock],r=e[p.SellValuePerStock];t&&typeof t==`number`&&(n[p.BuyValuePerStock]=(n[p.BuyValuePerStock]||0)+t*c),r&&typeof r==`number`&&(n[p.SellValuePerStock]=(n[p.SellValuePerStock]||0)+r*c)}}),r>0&&n[p.RealizedPL]&&(n[p.RealizedPLPct]=n[p.RealizedPL]/r*100),i>0&&n[p.UnrealizedPL]&&(n[p.UnrealizedPLPct]=n[p.UnrealizedPL]/i*100),n}var O=e(),k=e=>{let t=(0,O.c)(9),{price:n,low:r}=e;if(n==null||r==null||r===0){let e;return t[0]===Symbol.for(`react.memo_cache_sentinel`)?(e=(0,c.jsx)(`span`,{className:`text-gray-400`,children:`N/A`}),t[0]=e):e=t[0],e}let i=(n-r)/r*100,a=i<=0?0:i,o,s;t[1]===a?s=t[2]:(s=a.toFixed(1),t[1]=a,t[2]=s);let l=`${s}% above low`;if(a<=5)o=`inline-flex items-center px-2 py-1 rounded text-sm font-medium bg-green-800 text-white`,a===0&&(l=`Below 52W low`);else if(a<=10)o=`inline-flex items-center px-2 py-1 rounded text-sm font-medium bg-green-600 text-white`;else if(a<=20)o=`inline-flex items-center px-2 py-1 rounded text-sm font-medium bg-green-200 text-green-900`;else if(a<=30)o=`inline-flex items-center px-2 py-1 rounded text-sm font-medium bg-yellow-200 text-yellow-900`;else{o=`inline-flex items-center px-2 py-1 rounded text-sm font-medium text-gray-700`;let e;t[3]===a?e=t[4]:(e=a.toFixed(1),t[3]=a,t[4]=e),l=`${e}%`}let u=`${l} (current: ${n}, 52W low: ${r})`,d;return t[5]!==o||t[6]!==u||t[7]!==l?(d=(0,c.jsx)(`span`,{className:o,title:u,children:l}),t[5]=o,t[6]=u,t[7]=l,t[8]=d):d=t[8],d},A=e(),j=e=>{let t=(0,A.c)(6),{symbol:n,priceKey:r,priceMap:i,align:a}=e,o=i[n],s=o?.[r],l=`border border-gray-300 px-4 py-2${a===`right`?` text-right`:``}`,u;t[0]!==o||t[1]!==s?(u=o===void 0?(0,c.jsx)(`span`,{className:`text-gray-400`,children:`Loading...`}):s??(0,c.jsx)(`span`,{className:`text-gray-400`,children:`N/A`}),t[0]=o,t[1]=s,t[2]=u):u=t[2];let d;return t[3]!==l||t[4]!==u?(d=(0,c.jsx)(`td`,{className:l,children:u}),t[3]=l,t[4]=u,t[5]=d):d=t[5],d},M=e(),N=e=>{let t=(0,M.c)(16),{price:n,buyPerStock:r,sellPerStock:i}=e;if(n==null){let e;return t[0]===Symbol.for(`react.memo_cache_sentinel`)?(e=(0,c.jsx)(`span`,{className:`text-gray-400`,children:`N/A`}),t[0]=e):e=t[0],e}if(r!=null&&n<r){let e=(r-n)/r*100,i;t[1]===e?i=t[2]:(i=e.toFixed(1),t[1]=e,t[2]=i);let a=`Price ${n} is ${i}% below Buy Value Per Stock (${r})`,o;t[3]===e?o=t[4]:(o=e.toFixed(1),t[3]=e,t[4]=o);let s;return t[5]!==a||t[6]!==o?(s=(0,c.jsxs)(`span`,{className:`inline-flex items-center px-2 py-1 rounded text-sm font-medium bg-green-800 text-white`,title:a,children:[`Below Buy (`,o,`%)`]}),t[5]=a,t[6]=o,t[7]=s):s=t[7],s}if(i!=null&&n<i){let e=(i-n)/i*100,r;t[8]===e?r=t[9]:(r=e.toFixed(1),t[8]=e,t[9]=r);let a=`Price ${n} is ${r}% below Sell Value Per Stock (${i})`,o;t[10]===e?o=t[11]:(o=e.toFixed(1),t[10]=e,t[11]=o);let s;return t[12]!==a||t[13]!==o?(s=(0,c.jsxs)(`span`,{className:`inline-flex items-center px-2 py-1 rounded text-sm font-medium bg-green-200 text-green-900`,title:a,children:[`Below Sell (`,o,`%)`]}),t[12]=a,t[13]=o,t[14]=s):s=t[14],s}let a;return t[15]===Symbol.for(`react.memo_cache_sentinel`)?(a=(0,c.jsx)(`span`,{className:`text-gray-700`,children:`—`}),t[15]=a):a=t[15],a},P=e(),F=e=>{let t=(0,P.c)(13),{currentPrice:n,openValue:r,openQuantity:i}=e;if(n==null||r==null||i==null||i===0){let e;return t[0]===Symbol.for(`react.memo_cache_sentinel`)?(e=(0,c.jsx)(`span`,{className:`text-gray-400`,children:`N/A`}),t[0]=e):e=t[0],e}let a=r/i;if(n<a){let e=(a-n)/a*100,r;t[1]===n?r=t[2]:(r=n.toFixed(2),t[1]=n,t[2]=r);let i;t[3]===e?i=t[4]:(i=e.toFixed(1),t[3]=e,t[4]=i);let o;t[5]===a?o=t[6]:(o=a.toFixed(2),t[5]=a,t[6]=o);let s=`Current Price ${r} is ${i}% below Average Open Price (${o})`,l;t[7]===e?l=t[8]:(l=e.toFixed(1),t[7]=e,t[8]=l);let u;return t[9]!==s||t[10]!==l?(u=(0,c.jsxs)(`span`,{className:`inline-flex items-center px-2 py-1 rounded text-sm font-medium bg-green-600 text-white`,title:s,children:[`Below Open (`,l,`%)`]}),t[9]=s,t[10]=l,t[11]=u):u=t[11],u}let o;return t[12]===Symbol.for(`react.memo_cache_sentinel`)?(o=(0,c.jsx)(`span`,{className:`text-gray-700`,children:`—`}),t[12]=o):o=t[12],o},I=e(),L=[`SGBDE31III-GB`],R=e=>{let t=(0,I.c)(37),{stockData:n,priceMap:r}=e,[i,a]=(0,s.useState)(null),[o,l]=(0,s.useState)(null),u;t[0]!==i||t[1]!==o?(u=e=>{let t=E(e,i,o);a(t.sortColumn),l(t.sortDirection)},t[0]=i,t[1]=o,t[2]=u):u=t[2];let d=u,f;t[3]===n?f=t[4]:(f=n.filter(z),t[3]=n,t[4]=f);let g=f,_;t[5]!==g||t[6]!==r||t[7]!==i||t[8]!==o?(_=w(g,i,o,r),t[5]=g,t[6]=r,t[7]=i,t[8]=o,t[9]=_):_=t[9];let v=_,y;t[10]!==r||t[11]!==v?(y=D(v,r),t[10]=r,t[11]=v,t[12]=y):y=t[12];let b=y,x;t[13]!==i||t[14]!==o?(x=e=>T(e,i,o),t[13]=i,t[14]=o,t[15]=x):x=t[15];let S=x,C;t[16]===Symbol.for(`react.memo_cache_sentinel`)?(C={maxHeight:`500px`,overflowY:`auto`},t[16]=C):C=t[16];let O;t[17]!==S||t[18]!==d?(O=h.map(e=>(0,c.jsx)(`th`,{className:`border border-gray-300 px-4 py-2${e.align===`right`?` text-right`:``} sticky top-0 bg-gray-100 z-20 cursor-pointer hover:bg-gray-200 select-none`,style:{top:0},onClick:()=>d(e.key),children:(0,c.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,c.jsx)(`span`,{children:e.label}),S(e.key)]})},e.key)),t[17]=S,t[18]=d,t[19]=O):O=t[19];let A;t[20]===O?A=t[21]:(A=(0,c.jsx)(`thead`,{className:`bg-gray-100`,children:(0,c.jsx)(`tr`,{children:O})}),t[20]=O,t[21]=A);let M;if(t[22]!==r||t[23]!==v){let e;t[25]===r?e=t[26]:(e=(e,t)=>(0,c.jsx)(`tr`,{className:`hover:bg-gray-50`,children:h.map(t=>{if(m.includes(t.key)){let n=e[t.key],r=Number(n)>=0?`text-green-600`:`text-red-600`;return(0,c.jsx)(`td`,{className:`border border-gray-300 px-4 py-2${t.align===`right`?` text-right`:``} ${r}`,children:n},t.key)}if(t.key===p.NearFiftyTwoWeekLow){let n=r[e[p.Symbol]],i=n?.price??null,a=n?.fiftyTwoWeekLow??null;return(0,c.jsx)(`td`,{className:`border border-gray-300 px-4 py-2${t.align===`right`?` text-right`:``}`,style:{textAlign:t.align===`right`?`right`:`left`},children:(0,c.jsx)(k,{price:i,low:a})},t.key)}if(t.key===p.RealizedPriceVsValue){let n=r[e[p.Symbol]]?.price??e[p.CurrentPrice]??null,i=e[p.BuyValuePerStock]??null,a=e[p.SellValuePerStock]??null;return(0,c.jsx)(`td`,{className:`border border-gray-300 px-4 py-2${t.align===`right`?` text-right`:``}`,children:(0,c.jsx)(N,{price:n,buyPerStock:i,sellPerStock:a})},t.key)}if(t.key===p.UnrealizedPriceToCmp){let n=r[e[p.Symbol]]?.price??e[p.CurrentPrice]??null,i=e[p.OpenValue]??null,a=e[p.OpenQuantity]??null;return(0,c.jsx)(`td`,{className:`border border-gray-300 px-4 py-2${t.align===`right`?` text-right`:``}`,children:(0,c.jsx)(F,{currentPrice:n,openValue:i,openQuantity:a})},t.key)}return t.key===p.CurrentPrice?(0,c.jsx)(j,{symbol:e[p.Symbol],priceKey:`price`,priceMap:r,align:t.align},t.key):t.key===p.FiftyTwoWeekHigh?(0,c.jsx)(j,{symbol:e[p.Symbol],priceKey:`fiftyTwoWeekHigh`,priceMap:r,align:t.align},t.key):t.key===p.FiftyTwoWeekLow?(0,c.jsx)(j,{symbol:e[p.Symbol],priceKey:`fiftyTwoWeekLow`,priceMap:r,align:t.align},t.key):(0,c.jsx)(`td`,{className:`border border-gray-300 px-4 py-2${t.align===`right`?` text-right`:``}`,children:e[t.key]},t.key)})},t),t[25]=r,t[26]=e),M=v.map(e),t[22]=r,t[23]=v,t[24]=M}else M=t[24];let P;t[27]===M?P=t[28]:(P=(0,c.jsx)(`tbody`,{children:M}),t[27]=M,t[28]=P);let L;t[29]===b?L=t[30]:(L=h.map(e=>{let t=b[e.key];return[p.FiftyTwoWeekHigh,p.FiftyTwoWeekLow,p.CurrentPrice,p.CustomRealisedStockValue,p.CustomUnrealisedStockValue].includes(e.key)?(0,c.jsx)(`td`,{className:`border border-gray-300 px-4 py-2 bg-gray-200${e.align===`right`?` text-right`:``}`,children:`-`},`${e.key}-total`):e.key===p.Symbol?(0,c.jsx)(`td`,{className:`border border-gray-300 px-4 py-2 bg-gray-200 font-bold`,children:`TOTAL`},`${e.key}-total`):e.key===p.RealizedPLPct||e.key===p.UnrealizedPLPct?t!=null&&!isNaN(t)?(0,c.jsxs)(`td`,{className:`border border-gray-300 px-4 py-2 bg-gray-200 font-bold text-right ${t>=0?`text-green-600`:`text-red-600`}`,children:[t.toFixed(2),`%`]},`${e.key}-total`):(0,c.jsx)(`td`,{className:`border border-gray-300 px-4 py-2 bg-gray-200 text-right`,children:`-`},`${e.key}-total`):t!=null&&!isNaN(t)?(0,c.jsx)(`td`,{className:`border border-gray-300 px-4 py-2 bg-gray-200 font-bold${e.align===`right`?` text-right`:``}`,children:typeof t==`number`?t.toLocaleString(`en-IN`,{maximumFractionDigits:2,minimumFractionDigits:0}):t},`${e.key}-total`):(0,c.jsx)(`td`,{className:`border border-gray-300 px-4 py-2 bg-gray-200${e.align===`right`?` text-right`:``}`,children:`-`},`${e.key}-total`)}),t[29]=b,t[30]=L);let R;t[31]===L?R=t[32]:(R=(0,c.jsx)(`tfoot`,{className:`bg-gray-200 font-semibold sticky bottom-0 z-10`,children:(0,c.jsx)(`tr`,{children:L})}),t[31]=L,t[32]=R);let B;return t[33]!==P||t[34]!==R||t[35]!==A?(B=(0,c.jsx)(`div`,{className:`overflow-x-auto`,style:C,children:(0,c.jsxs)(`table`,{className:`min-w-full border-collapse border border-gray-300 relative`,children:[A,P,R]})}),t[33]=P,t[34]=R,t[35]=A,t[36]=B):B=t[36],B};function z(e){let t=e[p.Symbol];return!L.includes(t)}var B=()=>{let[e,t]=(0,s.useState)([]),[n,r]=(0,s.useState)(!0),[i,o]=(0,s.useState)(null),[u,f]=(0,s.useState)({}),[p,m]=(0,s.useState)(!1),[h,v]=(0,s.useState)(null),[y,x]=(0,s.useState)(null),[w,T]=(0,s.useState)(!1),[E,D]=(0,s.useState)(null),[O,k]=(0,s.useState)(null);(0,s.useEffect)(()=>{A()},[]);let A=async()=>{try{r(!0),o(null),T(!1);let e=await S();if(e){D(`json`),t(e.stocks),v(e.metadata.lastUpdated),x(e.metadata.lastPriceUpdate);let n={};e.stocks.forEach(e=>{(e[`Current Price`]!==void 0||e[`52W High`]!==void 0||e[`52W Low`]!==void 0)&&(n[e.Symbol]={price:e[`Current Price`]??null,fiftyTwoWeekHigh:e[`52W High`]??null,fiftyTwoWeekLow:e[`52W Low`]??null})}),f(n);return}D(null),T(!0)}catch(e){o(e instanceof Error?e.message:`Unknown error occurred`),console.error(`Error loading data:`,e)}finally{r(!1)}},j=(e,n)=>{t(e),f(n);let r=new Date().toISOString();v(r),x(r)},M=async(e,t)=>{r(!0),o(null);let n=_(await g(e)),i=await b(n.map(e=>e.Symbol));j(n.map(e=>({...e,"Current Price":i[e.Symbol]?.price??null,"52W High":i[e.Symbol]?.fiftyTwoWeekHigh??null,"52W Low":i[e.Symbol]?.fiftyTwoWeekLow??null})),i),T(!1),console.log(`Loaded data from: ${t}`)},N=async()=>{try{D(`private`);let e=await fetch(`/src/privateDocument/pnl-WAR042.xlsx`);if(!e.ok)throw Error(`Failed to load Excel file: ${e.status} ${e.statusText}`);await M(await e.arrayBuffer(),`pnl-WAR042.xlsx`)}catch(e){o(e instanceof Error?e.message:`Unknown error occurred`),console.error(`Error loading private Excel:`,e)}finally{r(!1)}},P=async e=>{let t=e.target.files?.[0]??null;if(t){k(t),D(`upload`);try{await M(await t.arrayBuffer(),t.name)}catch(e){o(e instanceof Error?e.message:`Unknown error occurred`),console.error(`Error loading uploaded Excel:`,e)}finally{r(!1)}}},F=async()=>{try{if(r(!0),o(null),E===`private`){console.log(`Refreshing data from privateDocument Excel and fetching fresh prices...`);let e=await fetch(`/src/privateDocument/pnl-WAR042.xlsx`);if(!e.ok)throw Error(`Failed to load Excel file: ${e.status} ${e.statusText}`);await M(await e.arrayBuffer(),`pnl-WAR042.xlsx`);return}if(E===`upload`){if(!O)throw Error(`No uploaded Excel file found. Please upload the file again.`);console.log(`Refreshing data from uploaded Excel and fetching fresh prices...`),await M(await O.arrayBuffer(),O.name);return}console.log(`Refreshing from JSON source is not supported. Use Update Prices instead.`)}catch(e){o(e instanceof Error?e.message:`Unknown error occurred`),console.error(`Error refreshing data:`,e)}finally{r(!1)}};return n?(0,c.jsx)(`div`,{className:`p-4`,children:`Loading Excel data...`}):w?(0,c.jsxs)(`div`,{className:`p-4`,children:[(0,c.jsx)(a,{}),(0,c.jsxs)(`div`,{className:`mb-4`,children:[(0,c.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Stock P&L Data`}),(0,c.jsx)(`p`,{className:`text-gray-600 mt-1`,children:`Choose how you want to load your Zerodha P&L Excel.`})]}),i&&(0,c.jsxs)(`div`,{className:`text-red-600 mb-4`,children:[`Error: `,i]}),(0,c.jsxs)(`div`,{className:`grid md:grid-cols-2 gap-4`,children:[(0,c.jsxs)(`div`,{className:`bg-white rounded-lg shadow-md p-4 border border-gray-200`,children:[(0,c.jsx)(`h2`,{className:`text-lg font-semibold text-gray-800`,children:`Upload Excel`}),(0,c.jsx)(`p`,{className:`text-sm text-gray-600 mt-1`,children:`Upload your Zerodha P&L Excel (.xlsx).`}),(0,c.jsx)(`div`,{className:`mt-3`,children:(0,c.jsx)(`input`,{type:`file`,accept:`.xlsx,.xls`,onChange:P,className:`block w-full text-sm text-gray-700`})})]}),(0,c.jsxs)(`div`,{className:`bg-white rounded-lg shadow-md p-4 border border-gray-200`,children:[(0,c.jsx)(`h2`,{className:`text-lg font-semibold text-gray-800`,children:`Load from Private Document`}),(0,c.jsxs)(`p`,{className:`text-sm text-gray-600 mt-1`,children:[`Loads `,(0,c.jsx)(`span`,{className:`font-mono`,children:`pnl-WAR042.xlsx`}),` from `,(0,c.jsx)(`span`,{className:`font-mono`,children:`src/privateDocument`}),`.`]}),(0,c.jsx)(`button`,{onClick:N,className:`mt-3 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600`,children:`Load from Private Document`})]})]})]}):i?(0,c.jsxs)(`div`,{className:`p-4`,children:[(0,c.jsxs)(`div`,{className:`text-red-600 mb-4`,children:[`Error: `,i]}),(0,c.jsx)(`button`,{onClick:F,className:`px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600`,children:`Retry`})]}):(0,c.jsxs)(`div`,{className:`p-4`,children:[(0,c.jsx)(a,{}),(0,c.jsxs)(`div`,{className:`mb-4 flex justify-between items-center`,children:[(0,c.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Stock P&L Data`}),(0,c.jsx)(l,{onUpdatePrices:async()=>{if(e.length!==0)try{m(!0);let e=await S();if(!e){console.warn(`No stored data found to update`);return}let n=await C(e);t(n.stocks),x(n.metadata.lastPriceUpdate);let r={};n.stocks.forEach(e=>{r[e.Symbol]={price:e[`Current Price`]??null,fiftyTwoWeekHigh:e[`52W High`]??null,fiftyTwoWeekLow:e[`52W Low`]??null}}),f(r),console.log(`Prices updated successfully`)}catch(e){console.error(`Error updating prices:`,e)}finally{m(!1)}},onRefreshData:F,updatingPrices:p})]}),(0,c.jsx)(d,{totalRecords:e.length,lastUpdated:h,lastPriceUpdate:y}),e.length>0?(0,c.jsx)(R,{stockData:e,priceMap:u}):(0,c.jsx)(`div`,{className:`text-gray-500`,children:`No data available`}),(0,c.jsx)(`div`,{className:`mt-8`,children:(0,c.jsxs)(`details`,{children:[(0,c.jsx)(`summary`,{className:`cursor-pointer text-blue-600 font-semibold`,children:`View Raw JSON Data (for analysis)`}),(0,c.jsx)(`pre`,{className:`mt-2 p-4 bg-gray-100 rounded overflow-auto max-h-96`,children:JSON.stringify(e,null,2)})]})})]})};export{B as default};